<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²ªé£Ÿè›‡éŠæˆ²</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        canvas {
            border: 2px solid #444;
            background-color: black;
        }
        .info {
            margin-top: 15px;
            font-size: 18px;
            text-align: center;
        }
        .score {
            font-weight: bold;
            color: #ff6b6b;
        }
        .controls {
            margin-top: 10px;
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1>ğŸ è²ªé£Ÿè›‡éŠæˆ²</h1>
    <div class="info">
        åˆ†æ•¸: <span id="score" class="score">0</span>
    </div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="controls">æ–¹å‘éµ æˆ– WASD æ§åˆ¶æ–¹å‘ | ç©ºç™½éµ: æš«åœ/ç¹¼çºŒ</div>

    <script>
        // ç²å– canvas èˆ‡ context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // éŠæˆ²è¨­å®š
        const gridSize = 20;
        const gridWidth = canvas.width / gridSize;
        const gridHeight = canvas.height / gridSize;
        let score = 0;

        // è›‡çš„åˆå§‹ç‹€æ…‹
        let snake = [
            {x: 10, y: 10},
            {x: 9, y: 10},
            {x: 8, y: 10}
        ];
        let direction = 'right'; // 'up', 'down', 'left', 'right'
        let nextDirection = 'right';
        let apple = generateApple();
        let gameRunning = true;
        let gameSpeed = 120; // msï¼Œæ•¸å€¼è¶Šå°è¶Šå¿«

        // ç”¢ç”Ÿæ–°è˜‹æœï¼ˆé¿å…èˆ‡è›‡é‡ç–Šï¼‰
        function generateApple() {
            let newApple;
            let overlapping;
            do {
                overlapping = false;
                newApple = {
                    x: Math.floor(Math.random() * gridWidth),
                    y: Math.floor(Math.random() * gridHeight)
                };
                // æª¢æŸ¥æ˜¯å¦èˆ‡è›‡èº«é‡ç–Š
                for (let segment of snake) {
                    if (segment.x === newApple.x && segment.y === newApple.y) {
                        overlapping = true;
                        break;
                    }
                }
            } while (overlapping);
            return newApple;
        }

        // ç•«è›‡
        function drawSnake() {
            snake.forEach((segment, index) => {
                ctx.fillStyle = index === 0 ? '#4CAF50' : '#8BC34A'; // é ­éƒ¨ç¶ è‰²æ›´æ·±
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                // ç•«é‚Šæ¡†è®“è›‡æ›´æ¸…æ™°
                ctx.strokeStyle = '#2E7D32';
                ctx.strokeRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
            });
        }

        // ç•«è˜‹æœ
        function drawApple() {
            ctx.fillStyle = '#FF5252'; // é®®ç´…è‰²
            ctx.beginPath();
            const centerX = apple.x * gridSize + gridSize / 2;
            const centerY = apple.y * gridSize + gridSize / 2;
            const radius = gridSize / 2 - 2;
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fill();

            // è˜‹æœæ¢—
            ctx.fillStyle = '#795548';
            ctx.fillRect(centerX - 1, apple.y * gridSize + 2, 2, 4);
        }

        // æ›´æ–°éŠæˆ²ç‹€æ…‹
        function update() {
            if (!gameRunning) return;

            // æ›´æ–°æ–¹å‘ï¼ˆé¿å… 180 åº¦æ‰é ­ï¼‰
            if (
                (nextDirection === 'up' && direction !== 'down') ||
                (nextDirection === 'down' && direction !== 'up') ||
                (nextDirection === 'left' && direction !== 'right') ||
                (nextDirection === 'right' && direction !== 'left')
            ) {
                direction = nextDirection;
            }

            // è¨ˆç®—æ–°é ­éƒ¨ä½ç½®
            const head = {...snake[0]};
            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }

            // æª¢æŸ¥æ’ç‰†
            if (head.x < 0 || head.x >= gridWidth || head.y < 0 || head.y >= gridHeight) {
                gameOver();
                return;
            }

            // æª¢æŸ¥æ’åˆ°è‡ªå·±
            for (let i = 0; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    gameOver();
                    return;
                }
            }

            // å°‡æ–°é ­åŠ å…¥
            snake.unshift(head);

            // æª¢æŸ¥æ˜¯å¦åƒåˆ°è˜‹æœ
            if (head.x === apple.x && head.y === apple.y) {
                // åƒåˆ°è˜‹æœï¼šåˆ†æ•¸ +1ï¼Œç”¢ç”Ÿæ–°è˜‹æœ
                score += 10;
                document.getElementById('score').textContent = score;
                apple = generateApple();
                // ä¸ç§»é™¤å°¾éƒ¨ â†’ è›‡è®Šé•·
            } else {
                // æ²’åƒåˆ°ï¼šç§»é™¤å°¾éƒ¨
                snake.pop();
            }
        }

        // ç•«é¢æ¸²æŸ“
        function draw() {
            // æ¸…ç©ºç•«å¸ƒï¼ˆé»‘è‰²èƒŒæ™¯ï¼‰
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawSnake();
            drawApple();

            // ç•«ç¶²æ ¼ï¼ˆå¯é¸ï¼Œè®“ç•«é¢æ›´æ¸…æ¥šï¼‰
            /*
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 0.5;
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            */
        }

        // éŠæˆ²ä¸»å¾ªç’°
        function gameLoop() {
            update();
            draw();
            setTimeout(gameLoop, gameSpeed);
        }

        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    nextDirection = 'up';
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    nextDirection = 'down';
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    nextDirection = 'left';
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    nextDirection = 'right';
                    break;
                case ' ':
                    // ç©ºç™½éµï¼šæš«åœ/ç¹¼çºŒ
                    gameRunning = !gameRunning;
                    if (gameRunning) gameLoop(); // æ¢å¾©æ™‚é‡æ–°å•Ÿå‹•å¾ªç’°
                    break;
            }
        });

        // éŠæˆ²çµæŸ
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.font = '30px Arial';
            ctx.fillStyle = '#FF5252';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '20px Arial';
            ctx.fillStyle = 'white';
            ctx.fillText(`åˆ†æ•¸: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            ctx.fillText('é»æ“Šç•«å¸ƒé‡æ–°é–‹å§‹', canvas.width / 2, canvas.height / 2 + 50);
        }

        // é‡æ–°é–‹å§‹éŠæˆ²
        canvas.addEventListener('click', () => {
            if (!gameRunning) {
                // é‡ç½®éŠæˆ²
                snake = [
                    {x: 10, y: 10},
                    {x: 9, y: 10},
                    {x: 8, y: 10}
                ];
                direction = 'right';
                nextDirection = 'right';
                apple = generateApple();
                score = 0;
                document.getElementById('score').textContent = '0';
                gameRunning = true;
                gameLoop();
            }
        });

        // å•Ÿå‹•éŠæˆ²
        draw(); // å…ˆç•«åˆå§‹ç•«é¢
        gameLoop();
    </script>
</body>
</html>